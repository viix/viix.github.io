---
title:        "ES6 In Depth (II)"
# jekyll-seo-tag
description:  "A reading note for es6 in depth"
author:       "viix"
---

_本系列文章为[《深入浅出ES6》](http://www.infoq.com/cn/es6-in-depth/)的读书笔记，感谢Mozilla的作者及InfoQ的译者_


## Template String

```javascript
`用户 ${user.name} 未被授权执行 ${action} 操作。`
```

到目前为止，我们所了解到的仅仅是比 + 运算符更优雅的语法，下面是你可能期待的一些特性细节：

- 模板占位符中的代码可以是任意JavaScript表达式，所以函数调用、算数运算等这些都可以作为占位符使用，你甚至可以在一个模板字符串中嵌套另一个，我称之为模板套构（template inception）。
- 如果这两个值都不是字符串，可以按照常规将其转换为字符串。例如：如果action是一个对象，将会调用它的.toString()方法将其转换为字符串值。
- 如果你需要在模板字符串中书写反撇号，你必须使用反斜杠将其转义：<code>`\``</code>等价于<code>"`"</code>。
- 同样地，如果你需要在模板字符串中引入字符$和{。无论你要实现什么样的目标，你都需要用反斜杠转义每一个字符：`\$`和`\{`。

与普通字符串不同的是，模板字符串可以多行书写：

```javascript
$("#warning").html(`
  <h1>小心！>/h1>
  <p>未经授权打冰球可能受罚
  将近${maxPenalty}分钟。</p>
`);
```

模板字符串中所有的空格、新行、缩进，都会原样输出在生成的字符串中。

标签模板的语法非常简单，在模板字符串开始的反撇号前附加一个额外的标签即可。我们的第一个示例将添加一个SaferHTML标签，我们要用这个标签来解决上述的第一个限制：自动转义特殊字符。

```javascript
var message =
  SaferHTML`<p>${bonk.sender} 向你示好。</p>`;
```

标签模板则完全简化了函数调用！
上面的代码等效于：

```javascript
var message =
  SaferHTML(templateData, bonk.sender);
```

如此一来，SaferHTML函数就可以有成千上万种方法来解析字符串和占位符。

在继续阅读以前，可能你苦苦思索到底用SaferHTML来做什么，然后着手尝试去实现它，归根结底，它只是一个函数，你可以在Firefox的开发者控制台里测试你的成果。

```javascript
function SaferHTML(templateData) {
  var s = templateData[0];
  for (var i = 1; i < arguments.length; i++) {
    var arg = String(arguments[i]);

    // 转义占位符中的特殊字符。
    s += arg.replace(/&/g, "&")
            .replace(/</g, "<")
            .replace(/</g, ">");

    // 不转义模板中的特殊字符。
    s += templateData[i];
  }
  return s;
}
```

通过这样的定义，标签模板SaferHTML`<p>${bonk.sender} 向你示好。</p>` 可能扩展为字符串 "<p>ES6<3er 向你示好。</p>"。即使一个恶意命名的用户，例如

```javascript
“黑客Steve<script>alert('xss');</script>”
```

，向其他用户发送一条骚扰信息，无论如何这条信息都会被转义为普通字符串，其他用户不会受到潜在攻击的威胁。

